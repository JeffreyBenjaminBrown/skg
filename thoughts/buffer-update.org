* rewriting how buffer update works
** relevant prior art
*** the old completion functions
    Search for functions with 'integrate' or 'complete' in the name
    to see how some of these ideas have been implemented,
    albeit likely in a less principled way, already.
*** the code under server/update_buffer/
*** the utilities under server::types::tree::
** how buffer update currently works
A call graph can be found at
tools/introspect/call-graph/output/update_from_and_rerender_buffer.org
*** skgnode_map : SkgNodeMap
    PITFALL: incomplete, so don't read from it directly;
    instead use skgnode_from_map_or_disk,
    which reads from disk and updates it when a key is empty.
*** source_diffs : Option<HashMap<SourceName, SourceDiff>>
    only for git-diff view
*** deleted_id_src_map : HashMap<ID, SourceName>
*** complete_or_restore_each_node_in_branch
**** allow indef nodes to be missing content
     don't complete their content
**** correct the aliasCol in an indef node
     It can't be wrong in a def node,
     so it doesn't need correcting there.
**** correct the SubscribeeCol in an indef node
     It can't be wrong in a def node
     so it doesn't need correcting there.
**** detect_and_mark_cycle
**** make_indef_if_repeat_then_extend_defmap
**** clobberIndefinitiveOrgnode
**** maybe_add_subscribeeCol_branch
*** view_requests : Vec < (NodeId, ViewRequest) >
    Was just for speed.
    Should instead interleave with other completion ops,
    but for each node perform view requests last,
    so that they can be integrated with overlapping content.
*** set_metadata_relationship_viewdata_in_forest
** how to redo buffer update
*** make these changes
**** AliasCol, SubscribeeCol, IDCol only need completion if
     their parent is an indef TrueNode.
     If it is definitive then they just defined the truth,
     so they don't need to be adjusted toward it.
     But completion should proceed within them.
*** write these functions
**** DONE completeAliasCol
     Take a treenode, a tree and a skgnodemap.
     Verify that the node is an AliasCol.
     Visits its parent, verifies it's a truenode,
     fetch the corresponding skgnode from the map,
     and reads the aliases into a variable
     'aliases' (a list of strings).
     'Complete' the AliasCol's children against 'aliases':

     First partition the AliasCol's children into two sets:
     truenodes with parentIgnores, and Alias nodes.
       (If anything does not fit those two categories,
       throw an error to the caller.)
     Put all the ignored truenodes first.
     Among the aliases, discard any whose text is not in 'aliases'.
     Create a new Alias node for each value in 'aliases'
     not found among the Alias treenodes.
     Add those new Alias treenodes to its Alias children,
     such that the resulting list of Alias children
     is equal to 'aliases', and in the same order.
**** DONE complete_relevant_children
**** DONE partition_children
**** DONE subtree_has_focus
**** DONE move_child_to_end
*** do these, in serial
**** DFS preorder (parent-first) completion
***** TrueNode
****** apply make_indef_if_repeat_then_extend_defmap to it
****** if it's definitive
******* reorder children and complete content
        Ensure your non-ignored truenode children are, and in order,
        equal to your contents.
        Reorder children to be non-truenodes,
        then parentIgnored truenodes, then content truenodes.
        In in git diff view, insert phantom nodes
        (it is implemented elsewhere)
        into the source of truth for the content list.
******* mark its erroneous content children as parent-ignores
        'erroneous content children' are truenode children
        not marked parentIgnores but not among its content
******** use another util, 'treat_certain_children'
******* if a SubscribeeCol is needed and absent, prepend one
        Don't populate it -- that happens later.
******* if a TextChanged is needed and absent, prepend one
        only in the git diff view
******* if an IDCol is needed and absent, prepend one
        only in the git diff view
****** if it's indefinitive
       clobberIndefinitiveOrgnode
***** SubscribeeCol
****** If there's a HiddenOutsideOfSubscribeeCol
       make sure it's last
**** DFS postorder (child-first) completion
***** DONE nothing to do : forestroot
***** DONE alias col
      read your parent, and then
      order and complete its aliases among your children
***** DONE nothing to do : alias
      but add a comment: for its own correctness, an alias must
        rely on its parent's having been processed correctly
***** DONE nothing to do : TextChanged
      but add a comment: for its own correctness, a TextChanged
        relies on its parent's having been processed correctly
***** DONE nothing to do : ID
      but add a comment: For correctness, an ID relies on
        its parent having been handled correctly.
***** IDCol
      Ensure that your children are only, and in order,
        the IDs of your parent.
***** HiddenInSubscribeeCol
      Read the col's ancestor 1 (Subscribee) and 3 (Subscriber),
      find everything subscriber hides that subscribee contains,
      and ensure your children are only those, and in order.
      Mark anything else 'parentIgnores'.
      If you have no children, remove yourself.
***** HiddenOutsideOfSubscribeeCol
      Read your siblings (subscribees) and parent (subscriber).
      Ensure that your children are, and in order,
        only what the subscriber hides that no subscribee contains.
      If you have no children, remove yourself.
***** SubscribeeCol
      read your parent, and then
      - ensure your non-ignored truenode children
        include all of its subscribees
      - mark any other truenode children 'parentIgnores',
        and move them to before the subscribees
      - append, after all the others, a HiddenOutsideOfSubscribeeCol
        (which will be removed if it would be childless).
        TRICKY: The HiddenOutsideOfSubscribeeCol
        must be processed after all the subscribees,
        so it can determine what they have already excluded.
        DFS postorder (children first) traversal ensures this.
***** TrueNode
      Process view requests.
      TRICKY: Best to do this once its content is recursively complete.
      The earlier preorder completion gives it all its children.
      This gives the view request maximum opportunity
      to use some of that content rather than create new content.
**** compute GraphNodeStats
     the function is currently called
       set_metadata_relationship_viewdata_in_forest
     but should be renamed
       set_graphnodestats_in_forest
**** compute ViewNodeStats
     This currently happens in at least two places.
       detect_and_mark_cycle is one of them.
     They should be collected into a single function,
       set_viewnodestats_in_forest
***** detect_and_mark_cycle
***** somewhere else
*** notes and complications
**** Contra previously, we correct aliases and other 'regenerables'
     As the code courrently stands, regenerating them.
     See the function remove_regenerable_scaffolds.
** cleanup
*** Isn't there already something like subtree_has_focus?
