Claude wrote this guide.
Jeff edited it but has not fact-checked it.

* First: Check If TypeDB Is Already Running

Before trying to start TypeDB, always check if it's already running.

** Quick Status Check (Recommended)

Use this script for a comprehensive status check:

#+begin_src bash
bash troubleshooting/typedb/check-typedb-status.sh
#+end_src

This will show:
- Whether TypeDB process is running
- Recent log entries
- Whether startup was successful
- Helpful commands for your situation

** Manual Check

You can also check manually:

#+begin_src bash
ps aux | grep typedb | grep -v grep
#+end_src

**Important:** Use `ps aux` (not `ps -a`). The `x` flag is necessary because TypeDB runs without a controlling terminal (shown as `?` in the TTY column). The `-a` flag alone won't show background daemon processes.

If you see output like this, TypeDB is already running:
#+begin_example
ubuntu    276330 10.5  0.8 6410476 130144 ?      Sl   14:45   1:02 /opt/typedb/core/server/typedb_server_bin
                                                 ^
                                    Note: ? means no terminal (this is normal for daemons)
#+end_example

Other commands that work:
- `pgrep typedb` - simple process name search
- `ps -ef | grep typedb` - alternative format

** "Address already in use" Error

If you try to run `typedb server` and get this error:
#+begin_example
error creating server listener: Address already in use (os error 98)
Exited with error: [SRO11] Could not serve gRPC on 0.0.0.0:1729.
#+end_example

This means TypeDB is **already running**. This is not a problem - you don't need to start it again.

** What to do

- If TypeDB is already running and working: Nothing! You're good.
- If you want to restart it:
  1. Kill the existing process: `pkill -f typedb`
  2. Start it fresh: `nohup typedb server > /home/ubuntu/logs/typedb.log 2>&1 < /dev/null &`
- If it's running but not responding: Check the log file and see the sections below

* TypeDB Exits Immediately After "Ready!" Message
** Symptoms
- TypeDB log shows "Ready!" message indicating successful startup
- Process appears in `ps` output briefly but then disappears
- No error messages in the log file
- Log file ends cleanly with "Ready!" but process is not running
** Root Cause
This happens when TypeDB is backgrounded without redirecting stdin from /dev/null. The process receives EOF on stdin (either when the shell session ends or stdin closes) and exits gracefully. Since it's a clean exit after successful startup, no error is logged.
** Solution
Always redirect stdin from /dev/null when backgrounding TypeDB:
#+begin_src bash
nohup typedb server > /home/ubuntu/logs/typedb.log 2>&1 < /dev/null &
#+end_src

The critical part is `< /dev/null` which disconnects stdin from the terminal.

** Verification
After starting TypeDB, wait a few seconds and verify it's still running:
#+begin_src bash
sleep 5 && ps aux | grep -v grep | grep typedb
#+end_src

You should see the typedb_server_bin process running.

** Note
This issue was fixed in `/home/ubuntu/bash/run-servers.sh` on 2025-10-14. If you're using that script, it should now work correctly. If you're manually starting TypeDB, remember to include the stdin redirection.

* Test Database Accumulation & "Too Many Open Files"

** Quick Fix

If TypeDB fails to start with "Too many open files" errors:

#+begin_src bash
# Nuclear option - when TypeDB is crashed and won't start
pkill -9 -f typedb_server_bin
rm -rf /opt/typedb/core/server/data/skg-test*
nohup typedb server > /home/ubuntu/logs/typedb.log 2>&1 < /dev/null &
#+end_src

If TypeDB is still running (but struggling), use the API-based cleanup:
#+begin_src bash
cargo run --bin cleanup-test-dbs
pkill -f typedb
nohup typedb server > /home/ubuntu/logs/typedb.log 2>&1 < /dev/null &
#+end_src

** Complete Documentation

See ~troubleshooting/typedb/database-cleanup.md~ for comprehensive documentation including:
- Problem symptoms and root causes
- Cleanup utilities (Rust-based and shell-based)
- Automatic cleanup in integration tests
- Database naming conventions
- Prevention strategies
- Monitoring commands

** Diagnostic Tools

*** Check TypeDB Status
#+begin_src bash
bash troubleshooting/typedb/check-typedb-status.sh
#+end_src
Shows: process status, recent logs, helpful commands

*** Check Database Count
#+begin_src bash
bash troubleshooting/typedb/check-typedb-databases.sh
#+end_src
Shows: count of test/corrupt/okay databases, recommendations

** Legacy Approach (Filesystem-Based)

*WARNING*: Manual filesystem deletion can cause TypeDB to crash if databases are open.
Only use if TypeDB is NOT running.

#+begin_src bash
# Only use if TypeDB is NOT running
rm -rf /opt/typedb/core/server/data/skg-test*
#+end_src

* Database Corruption (Non-Accumulation Issues)
